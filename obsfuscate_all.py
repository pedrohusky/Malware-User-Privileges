import os
import sys
from tools.obfuscate import obfuscate_file

# Import obfuscate.py
sys.path.append(os.getcwd())
script_dir = os.path.dirname(os.path.realpath(__file__))

# List of directories to obfuscate
directories_to_obfuscate = ["tools"]

# Obtain the directory of the script
script_dir = os.path.dirname(os.path.realpath(__file__))

# Obtain the path for the "obfuscated" directory
obfuscated_dir = os.path.join(script_dir, "obfuscated")


def obfuscate_files(dir_path):
    # Loop through all files and directories in the current directory
    for item in os.listdir(dir_path):
        item_path = os.path.join(dir_path, item)

        # If the item is a directory, recursively call the function
        if os.path.isdir(item_path):
            obfuscate_files(item_path)
        # If the item is a .py file, obfuscate it
        elif item_path.endswith(".py") and "obfuscate.py" not in item_path:
            # Determine the relative path for the item, to use in the obfuscated directory
            relative_path = os.path.relpath(item_path, script_dir)
            obfuscated_path = os.path.join(obfuscated_dir, relative_path)

            # Ensure the directory for the obfuscated file exists
            os.makedirs(os.path.dirname(obfuscated_path), exist_ok=True)

            # Call the obfuscate function
            obfuscate_file(item_path, 10)


def rename_files(dir_path):
    # Loop through all files and directories in the current directory
    for item in os.listdir(dir_path):
        item_path = os.path.join(dir_path, item)

        # If the item is a directory, recursively call the function
        if os.path.isdir(item_path):
            rename_files(item_path)
        # If the item is a file and its name contains "obfuscated", rename it
        elif "obfuscated" in item:
            new_name = item.replace("-obfuscated", "")
            new_path = os.path.join(dir_path, new_name)
            os.rename(item_path, new_path)
            print(f"Renamed {item_path} to {new_path}")


# Call the function to start the process for each directory
 # Recursively walk through all files in the directory

for root, dirs, files in os.walk(script_dir):
    if "venv" not in root and "targets" not in root and 'obfuscated' not in root:

        for filename in files:
            filepath = os.path.join(root, filename)
            if filepath.endswith(".py") and "obfuscate.py" not in filepath:
                # Determine the relative path for the item, to use in the obfuscated directory
                relative_path = os.path.relpath(filepath, script_dir)
                obfuscated_path = os.path.join(obfuscated_dir, relative_path)

                # Ensure the directory for the obfuscated file exists
                os.makedirs(os.path.dirname(obfuscated_path), exist_ok=True)

                # Call the obfuscate function
                obfuscate_file(filepath, 10)

rename_files(script_dir)
